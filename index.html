<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>AI‑chat</title>
</head>
<body>
  <textarea id="messageInput"></textarea>
  <button id="sendBtn">Skicka</button>
  <div id="replyOutput"></div>

  <!-- Lägg script sist -->
  <script type="module">
    import TTLStorage from './ttlStorage.js';         // om du behöver
    import ShowOneChild from './ShowOneChild.js';     // om du använder den

    // Initiera dina klasser/globalt
    const app = new ShowOneChild(new TTLStorage());
    document.addEventListener('DOMContentLoaded', () => {
      // 1) Bind chat‑knapp
      const sendBtn = document.getElementById('sendBtn');
      sendBtn?.addEventListener('click', async () => {
        const input = document.getElementById('messageInput').value;
        const output = document.getElementById('replyOutput');
        try {
          output.textContent = 'Skickar…';
          const resp = await fetch('/api/anthropic', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: input })
          });
          if (!resp.ok) throw new Error(await resp.text());
          const data = await resp.json();
          if (data.error) throw new Error(data.error);
          output.textContent = data.reply;
        } catch (e) {
          output.textContent = `Fel: ${e.message}`;
        }
      });

      // 2) Rendera eventuellt annat UI
      app.render();
    });

    // 3) WebSocket
    let socket;
    try {
      socket = new WebSocket('ws://localhost:7000/');
      socket.addEventListener('error', console.error);
    } catch (e) {
      console.warn('WebSocket ej tillgänglig:', e);
    }
  </script>
</body>
</html>
